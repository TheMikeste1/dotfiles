---
- name: Build mold linker
  hosts: localhost
  tasks:
    - name: Pull
      ansible.builtin.git:
        repo: git@github.com:rui314/mold.git
        dest: ~/src/mold
        clone: true
        update: true
        single_branch: true
        version: stable
      register: mold_build_pull
    - name: Configure
      command:
        chdir: ~/src/mold
        cmd: cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_COMPILER=c++ -B build
      when: mold_build_pull.changed
    - name: Build
      command:
        chdir: ~/src/mold
        cmd: cmake --build build --parallel
      when: mold_build_pull.changed
    - name: Install
      become: true
      command:
        chdir: "{{ ansible_facts.user_dir }}/src/mold"
        cmd: cmake --build build --target install
      when: mold_build_pull.changed
